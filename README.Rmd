---
output: github_document
---

<!-- README.md is generated from README.Rmd. Please edit that file -->

```{r, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>",
  fig.path = "man/figures/README-",
  out.width = "100%"
)
```

# openalexR

<!-- badges: start -->

<!-- badges: end -->

The goal of openalexR is to gather bibliographic metadata about publications, authors, venues, institutions and concepts from OpenAlex using API.

OpenAlex is a fully open catalog of the global research system.
It's named after the ancient [Library of Alexandria](https://en.wikipedia.org/wiki/Library_of_Alexandria).
The OpenAlex dataset describes scholarly entities and how those entities are connected to each other.
There are five types of entities:

-   **Works** are papers, books, datasets, etc; they cite other works

-   **Authors** are people who create works

-   **Venues** are journals and repositories that host works

-   **Institutions** are universities and other orgs that are affiliated with works (via authors)

-   **Concepts** *tag* Works with a topic

(source: [OpenAlex website](https://openalex.org))

## Installation

You can install the developer version of the openalexR from [GitHub](https://github.com) with:

```{r eval=FALSE}
install.packages("remotes")
remotes::install_github("massimoaria/openalexR")
```

You can install the released version of openalexR from [CRAN](https://CRAN.R-project.org) with:

```{r eval=FALSE}
install.packages("openalexR")
```

## Package loading

```{r}
library(openalexR)
library(dplyr)
```

# openalexR overview

The basic idea of openalexR is to provide three main functions helping the user to:

-   Create a query by passing one or more arguments to a function (function **oa_query**)

-   Gather a collection of entities in JSON format (function **oa_request**)

-   Transform the JSON in a data frame (similar to an excel sheet) can be used as input in a bibliometric or science mapping analysis (e.g. using the bibliometrix package) (function **oa2df**)

OpenAlex defined a custom query language based on entity type.
You can choose to write a valid query using that language or, in alternative, using the function **oa_query**.

**oa_query** generates a valid query, written following the OpenAlex API language, from a set of arguments provided by the user.

The function **oa_request** downloads a collection of entities matching the query created by **oa_query** or manually written by the user.
The function will return a JSON object in a list format.

Finally, the function **oa2df** converts the JSON object in classical bibliographic data frame.

## Get full records through entity IDs

### Query to obtain all information about a single publications

The following paper:

    Aria, M., & Cuccurullo, C. (2017). bibliometrix: 
    An R-tool for comprehensive science mapping analysis. 
    Journal of informetrics, 11(4), 959-975.

is associated to the OpenAlex-id **W2755950973**.

In this example, we need to pass a single argument to the function, that is, the identifier of the entity to download: `identifier = "W2755950973"`.

```{r}
paper_id <- oa_fetch(
  identifier = "W2755950973",
  entity = "works",
  verbose = TRUE
)
dplyr::glimpse(paper_id)
```

**oa_fetch** is a composition of functions: `oa_query |> oa_request |> oa2df`.
As results, **oa_query** returns the query string including the OpenAlex endpoint API server address (default).
**oa_request** downloads the bibliographic records matching the query.
Finally, **oa2df** converts the final result list to a tibble.


### External id formats

OpenAlex endpoint accepts an OpenAlex ID, but many [external IDs](https://docs.openalex.org/api/get-single-entities#id-formats) (*e.g.*, DOI, ISSN) are accepted as well, in several formats, 
including Digital Object Identifier (DOI) and Persistent Identifiers (PIDs).

We can get a publication record through its DOI using the format **doi:***doi identifier*.
Example:

```{r}
paper_doi <- oa_fetch(
  # identifier = "doi:https://doi.org/10.1016/j.joi.2017.08.007" # would also work (PIDs)
  identifier = "doi:10.1016/j.joi.2017.08.007",
  entity = "works"
)
dplyr::glimpse(paper_doi)
```



### More than one publications

To download the records of two or more identifiers through a single query, 
we may be tempted to recursively apply **oa_request** to each id using the function **lapply**.
Some

```{r eval=FALSE}
c("W3005144120", "W2755950973") %>% 
  lapply(function(x) {
  oa_request(
    query_url = oa_query(
      identifier = x,
      entity = "works"
    )
  )
}) %>% 
  oa2df(entity = "works")

```

However, the recommended way to avoid [burst rate limits](https://docs.openalex.org/api#rate-limits) (especially when we have a lot of identifiers) is to use a [filter](https://docs.openalex.org/api/get-lists-of-entities/filter-entity-lists),
in this case, by the [openalex](https://docs.openalex.org/about-the-data/work#ids) attribute:

```{r}
paper_oa <- oa_fetch(
  openalex = c("W3005144120", "W2755950973"),
  entity = "works",
  verbose = TRUE
)
```


## Authors

### Single author

The author Massimo Aria is associated to the OpenAlex-id A923435168.

```{r}
oa_fetch(
  identifier = "A923435168",
  count_only = TRUE,
  verbose = TRUE
) %>% 
  dplyr::glimpse()

```

```{r}
oa_fetch(
  identifier = "A923435168",
  entity = "authors",
  count_only = FALSE
) %>% 
  dplyr::glimpse()
```





## Filters

In most cases, we are interested in downloading a collection of items that meet one or more inclusion/exclusion criteria (filters).
Filters narrow the list down to just entities that meet a particular condition--specifically, a particular value for a particular attribute.
Supported attributes for each endpoints are listed on [OpenAlex API Documentation Website](https://docs.openalex.org/api/get-lists-of-entities#filter).

### Works

**Example**:
We want to download all works, cited more than 50 times, published between 2020 and 2021, which include the strings "bibliometric analysis" or "science mapping" in the title.
Maybe we also want the results to be sorted by total citations in a descending order.


Setting the argument count_only=TRUE, the function **oa_request** returns the number of items matching the query without downloading the collection.


```{r}
oa_fetch(
  identifier = NULL,
  entity = "works",
  title.search = c("bibliometric analysis", "science mapping"),
  cited_by_count = ">50", 
  from_publication_date = "2020-01-01",
  to_publication_date = "2021-12-31",
  search = NULL,
  sort = "cited_by_count:desc",
  endpoint = "https://api.openalex.org/",
  count_only = TRUE,
  verbose = TRUE
)
```


We can now download the records and transform it into a tibble/data frame:

```{r}
oa_fetch(
  entity = "works",
  title.search = c("bibliometric analysis", "science mapping"),
  cited_by_count = ">50", 
  from_publication_date = "2020-01-01",
  to_publication_date = "2021-12-31",
  sort = "cited_by_count:desc",
  count_only = FALSE
) %>% 
  dplyr::glimpse()
```

### Authors

**Example**:
We want download all authors' records of scholars who work at the University of Naples Federico II (OpenAlex ID: I71267560) and who have published more than 499 works.

Let's first check how many records match the query,
then set `count_only = FALSE` to download the entire collection.
We can do this by first defining a list of arguments, then adding `count_only` (default `FALSE`) to this list:

```{r}
my_arguments <- list(
  entity = "authors",
  last_known_institution.id = "I71267560",
  works_count = ">499"
  )

do.call(oa_fetch, c(my_arguments, list(count_only = TRUE)))
do.call(oa_fetch, my_arguments) %>% 
  dplyr::glimpse()

```

### Institutions

We want download all records regarding Italian institutions (country_code:it) that are classified as educational (type:education).
Again, we check how many records match the query then download the collection:

```{r}
italian_insts <- list(
  entity = "institutions",
  country_code = "it",
  type = "education",
  verbose = TRUE
)

do.call(oa_fetch, c(italian_insts, list(count_only = TRUE)))
dplyr::glimpse(do.call(oa_fetch, italian_insts))
```



### Venues (think journals)

We want download all records regarding journals that have published more than 100,000 works:

```{r}
big_journals <- list(
  entity = "venues",
  works_count = ">100000",
  verbose = TRUE
)

do.call(oa_fetch, c(big_journals, list(count_only = TRUE)))
dplyr::glimpse(do.call(oa_fetch, big_journals))
```

### Concepts (think theme, keywords)

We want to download the records of all the concepts that concern at least one million works:

```{r}
popular_concepts <- list(
  entity = "concepts",
  works_count = ">1000000",
  verbose = TRUE
)

do.call(oa_fetch, c(popular_concepts, list(count_only = TRUE)))
dplyr::glimpse(do.call(oa_fetch, popular_concepts))
```



### Other examples

*Get all works citing a particular work*

We can download all publications citing another publication by using the filter attribute **cites**.

For example, if we want to download all publications citing the article Aria and Cuccurullo (2017), we have just to set the argument filter as `cites = "W2755950973"`
where "W2755950973" is the OA id for the article by Aria and Cuccurullo.

```{r}
aria_count <- oa_fetch(
  entity = "works",
  cites = "W2755950973",
  count_only = TRUE,
  verbose = TRUE
) 
aria_count
```

This query will return a collection of `r aria_count["count"]` publications.
Let's to download it and then to convert it into a data frame:

```{r}
oa_fetch(
  entity = "works",
  cites = "W2755950973",
  count_only = TRUE,
  verbose = TRUE
) %>% 
  dplyr::glimpse()
```


## Convert an OpenAlex data frame to a bibliometrix object

The bibliometrix R-package (<https://www.bibliometrix.org>) provides a set of tools for quantitative research in bibliometrics and scientometrics.
Today it represents one of the most used science mapping software in the world.
In a recent survey on bibliometric analysis tools, Moral-Muñoz et al. (2020) wrote: “At this moment, maybe Bibliometrix and its Shiny platform contain the more extensive set of techniques implemented, and together with the easiness of its interface, could be a great software for practitioners”.

The function **oa2bibliometrix** converts a bibliographic data frame of works into a bibliometrix object.
This object can be used as input collection of a science mapping workflow.

```{r}
bib_ls <- list(
  identifier = NULL,
  entity = "works",
  cites = "W2755950973",
  from_publication_date = "2022-01-01",
  to_publication_date = "2022-03-31"
)

do.call(oa_fetch, c(bib_ls, list(count_only = TRUE)))
do.call(oa_fetch, bib_ls) %>% 
  oa2bibliometrix() %>% 
  dplyr::glimpse()
```

